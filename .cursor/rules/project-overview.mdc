---
alwaysApply: true
---

# Jaqen Project Overview

Jaqen is a Go CLI tool for Football Manager that creates and manages image file mappings to face profiles for regen players. It's inspired by NewGAN-Manager but designed to work natively on Linux.

## Project Structure

- **Entry Point**: [main.go](mdc:main.go) - Simple entry point that calls cmd.Execute()
- **CLI Commands**: [cmd/](mdc:cmd/) - Cobra-based CLI implementation
  - [cmd/root.go](mdc:cmd/root.go) - Main command with face mapping logic
  - [cmd/format.go](mdc:cmd/format.go) - Config file formatting command
- **Core Logic**: [pkgs/](mdc:pkgs/) - Main business logic packages
  - [pkgs/mapping.go](mdc:pkgs/mapping.go) - XML mapping file handling
  - [pkgs/players.go](mdc:pkgs/players.go) - RTF file player parsing
  - [pkgs/images.go](mdc:pkgs/images.go) - Image pool management
  - [pkgs/constants.go](mdc:pkgs/constants.go) - Ethnic groups and nation mappings
- **Internal**: [internal/](mdc:internal/) - Internal utilities and config handling
  - [internal/types.go](mdc:internal/types.go) - Configuration struct definitions
  - [internal/utils.go](mdc:internal/utils.go) - TOML config parsing utilities
  - [internal/constants.go](mdc:internal/constants.go) - Default configuration values
- **Documentation**: [docs/](mdc:docs/) - Setup guides and screenshots
- **Examples**: [example/](mdc:example/) - Sample configuration files

## Key Concepts

### Ethnic Groups
The tool maps Football Manager nations to ethnic groups for face generation:
- African, Asian, Caucasian, Central European, EECA (Eastern European Central Asian)
- Italmed (Italian Mediterranean), MENA (Middle East North African), MESA (Middle East South Asian)
- SAMed (South American Mediterranean), Scandinavian, Seasian (South East Asian)
- South American, SpanMed (Spanish Mediterranean), YugoGreek (Yugoslav Greek)

### File Types
- **config.xml**: Football Manager's face mapping configuration file
- **newgen.rtf**: RTF file containing player data exported from FM
- **jaqen.toml**: Configuration file for the tool itself
- **Image directories**: Organized by ethnic group subdirectories

### Core Workflow
1. Parse RTF file to extract player data (ID, nationality, ethnic group)
2. Map nations to ethnic groups (with override support)
3. Select random images from appropriate ethnic group directories
4. Generate XML mapping file for Football Manager
5. Write updated config.xml file

## Dependencies
- **github.com/spf13/cobra**: CLI framework
- **github.com/pelletier/go-toml/v2**: TOML configuration parsing
- **github.com/deckarep/golang-set/v2**: Set data structure for ethnic groups

## Configuration Priority
1. Command line flags (highest priority)
2. TOML config file values
3. Default values (lowest priority)

The tool supports preserving existing mappings, allowing duplicate image assignments, and custom nation-to-ethnic group overrides.