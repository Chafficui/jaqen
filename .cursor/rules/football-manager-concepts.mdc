---
description: Football Manager file formats, concepts, and domain-specific knowledge
---

# Football Manager File Formats and Concepts

## File Types and Formats

### config.xml
- **Purpose**: Football Manager's face mapping configuration file
- **Location**: Usually in FM's graphics directory
- **Format**: XML with player ID to image path mappings
- **Processing**: Read existing mappings, update with new assignments, write back
- **Key Elements**: Player IDs mapped to relative image paths

### newgen.rtf
- **Purpose**: RTF file containing player data exported from Football Manager
- **Format**: Rich Text Format with embedded player information
- **Data Extracted**: Player ID, nationality, ethnic group classification
- **Processing**: Parsed to extract player demographics for face assignment

### Image Directory Structure
- **Organization**: Images organized by ethnic group subdirectories
- **Path Format**: `{ethnic_group}/{image_filename}`
- **Supported Formats**: Standard image formats (JPG, PNG, etc.)
- **Naming**: Images should have descriptive filenames

## Domain Concepts

### Regen Players
- **Definition**: Computer-generated players that appear in Football Manager
- **Purpose**: Maintain realistic player pools as real players retire
- **Face Assignment**: Each regen needs a face image for visual representation
- **Demographics**: Regen players inherit nationality and ethnic characteristics

### Ethnic Group Classification
The tool maps Football Manager nations to ethnic groups for realistic face assignment:

| Ethnic Group | Code | Description |
|--------------|------|-------------|
| African | African | Sub-Saharan African features |
| Asian | Asian | East Asian features |
| Caucasian | Caucasian | European/North American features |
| Central European | Central European | Central European features |
| Eastern European Central Asian | EECA | Slavic/Central Asian features |
| Italian Mediterranean | Italmed | Mediterranean European features |
| Middle East North African | MENA | Middle Eastern/North African features |
| Middle East South Asian | MESA | South Asian/Middle Eastern features |
| South American Mediterranean | SAMed | Mediterranean South American features |
| Scandinavian | Scandinavian | Nordic features |
| South East Asian | Seasian | Southeast Asian features |
| South American | South American | Indigenous South American features |
| Spanish Mediterranean | SpanMed | Iberian/Mediterranean features |
| Yugoslav Greek | YugoGreek | Balkan/Greek features |

### Nation-to-Ethnic Mapping
- **Default Mapping**: Defined in [pkgs/constants.go](mdc:pkgs/constants.go) as `NationEthnicMapping`
- **Override Support**: Users can override mappings via TOML config
- **Nation Codes**: Use FIFA country codes (e.g., ENG, GER, BRA, USA)
- **Validation**: Ensure override ethnic codes are valid

## Processing Workflow

### Face Assignment Process
1. **Parse RTF**: Extract player data (ID, nationality, ethnic group)
2. **Map Nation**: Convert nationality to ethnic group (with override support)
3. **Select Image**: Randomly choose image from appropriate ethnic directory
4. **Generate Mapping**: Create player ID to image path mapping
5. **Update XML**: Write new mappings to config.xml

### Image Pool Management
- **Exclusion**: Remove already-assigned images (unless duplicates allowed)
- **Random Selection**: Choose random image from available pool
- **Path Resolution**: Handle relative paths between XML and image directories
- **Validation**: Ensure selected images exist and are accessible

### Configuration Options
- **Preserve**: Keep existing mappings when updating
- **Allow Duplicates**: Permit same image for multiple players
- **Version Support**: Handle different Football Manager versions
- **Path Flexibility**: Support various directory structures

## File Path Handling

### Relative Path Resolution
- Calculate relative path from XML file to image directory
- Handle cases where XML is inside image directory
- Use `filepath.Rel()` for cross-platform path resolution
- Trim unnecessary `./` prefixes

### Cross-Platform Compatibility
- Use `filepath` package for path operations
- Handle Windows and Unix path separators
- Ensure paths work in Football Manager on different platforms